<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">

<beans>
  
  <bean id="JndiConnection" class="org.openadaptor.auxil.connector.jndi.JNDIConnection">
    <property name="initialContextFactory" value="org.jnp.interfaces.NamingContextFactory"/>
    <property name="providerUrl" value="jnp://localhost:1099"/>
  </bean>
  
  <bean id="JmsConnection" class="org.openadaptor.auxil.connector.jms.JMSConnection">
    <property name="jndiConnection" ref="JndiConnection"/>
    <property name="connectionFactoryName" value="ConnectionFactory"/>
    <property name="destinationName" value="queue/testQueue"/>
    <!-- property name="queue" value="true"/ -->
    <property name="durable" value="true"/>
  </bean>
  
  <bean id="Publisher" class="org.openadaptor.core.adaptor.Adaptor">
    <property name="messageProcessor">
      <bean class="org.openadaptor.core.router.Router">
        <property name="routingMap">
          <bean class="org.openadaptor.core.router.RoutingMap">
            <property name="processMap">
              <map>
                <entry key-ref="TestReader" value-ref="JmsPublisher"/>
              </map>
            </property>
          </bean>
        </property>
      </bean>
    </property>
  </bean>
  
  <bean id="TestReader" class="org.openadaptor.core.connector.TestReadConnector">
    <property name="dataString" value="foobar"/>
  </bean>
  
  <bean id="JmsPublisher" class="org.openadaptor.auxil.connector.jms.JMSWriteConnector">
    <property name="jmsConnection" ref="JmsConnection"/>
  </bean>
  
  <bean id="Subscriber" class="org.openadaptor.core.adaptor.Adaptor">
    <property name="messageProcessor">
      <bean class="org.openadaptor.core.router.Router">
        <property name="routingMap">
          <bean class="org.openadaptor.core.router.RoutingMap">
            <property name="processMap">
              <map>
                <entry key-ref="JmsSubscriber" value-ref="TestWriteConnector"/>
              </map>
            </property>
          </bean>
        </property>
      </bean>
    </property>
  </bean>
  
  <bean id="JmsSubscriber" class="org.openadaptor.auxil.connector.jms.JMSReadConnector">
    <property name="jmsConnection" ref="JmsConnection"/>
  </bean>
  
  <bean id="TestWriteConnector" class="org.openadaptor.core.connector.TestWriteConnector">
    <property name="expectedOutput" value="foobar"/>
  </bean>
  
</beans>