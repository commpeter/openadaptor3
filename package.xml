<?xml version="1.0" encoding="UTF-8"?>
<project name="openadaptor-package" default="zippedpackage">
  
  <import file="build.xml"/>
  
  <property name="dir.package" value="package"/>
  <property name="dir.package.lib" value="${dir.package}/lib"/>
  <property name="dir.package.example" value="${dir.package}/example"/>
  <property name="dir.package.sql" value="${dir.package}/sql"/>
  <property name="dir.package.doc" value="${dir.package}/doc"/>
  
  <target name="clean">
    <delete dir="${dir.package}"/>
  </target>
  
  <target name="zippedpackage" depends="package, zip" description="create zipped package"/>
  
  <target name="package" depends="clean, lib, sql, example, doc"/>
  
  <target name="zip">
    <zip destfile="openadaptor-${tag}-bin.zip">
      <zipfileset dir="${dir.package}" prefix="openadaptor-${tag}"/>
    </zip>
  </target>
  
  <target name="lib" depends="buildtools.taskdef">
    <mkdir dir="${dir.package}"/>
    <mkdir dir="${dir.package.lib}"/>
    <mkdir dir="${dir.package.lib}/3rdparty"/>
    <jar destfile="${dir.package.lib}/openadaptor.jar">
      <fileset dir="${dir.classes}"/>
    </jar>
    <jar destfile="${dir.package.lib}/openadaptor-stub.jar">
      <fileset dir="${dir.stub.classes}"/>
    </jar>
    <jar destfile="${dir.package.lib}/openadaptor-spring.jar">
      <fileset dir="${dir.spring.classes}"/>
    </jar>
    <jarcopy todir="${dir.package.lib}/3rdparty" versionProperties="${basedir}/jarversions.properties" version="${tag}" manifest="${basedir}/lib/MANIFEST.MF">
      <fileset dir="${dir.lib}">
        <include name="*.jar"/>
        <include name="*.zip"/>
      </fileset>
      <fileset dir="${dir.spring.lib}">
        <include name="*.jar"/>
        <include name="*.zip"/>
      </fileset>
    </jarcopy>
    <jarcopy todir="${dir.package.lib}/3rdparty" versionProperties="${basedir}/jarversions.properties" version="${tag}">
      <fileset dir="${dir.test.lib}">
        <include name="*.jar"/>
        <include name="*.zip"/>
      </fileset>
    </jarcopy>
    <jar destfile="${dir.package.lib}/openadaptor-depends.jar" manifest="lib/MANIFEST.MF">
      <zipgroupfileset dir="${dir.lib}" includes="*.jar,*.zip" excludes="mail.jar,activation.jar"/>
      <zipgroupfileset dir="${dir.spring.lib}" includes="*.jar,*.zip"/>
    </jar>
    <copy todir="${dir.package.lib}">
      <fileset dir="${dir.lib}">
        <include name="log4j.properties"/>
      </fileset>
    </copy>
  </target>
  
  <target name="example">
    <copy todir="${dir.package.example}">
      <fileset dir="${dir.example}">
        <include name="README*"/>
        <include name="spring/**"/>
        <include name="src/**"/>
        <include name="bin/**"/>
      </fileset>
    </copy>
    <chmod perm="+x">
      <fileset dir="${dir.package.example}/bin"/>
    </chmod>
  </target>
  
  <target name="sql">
    <copy todir="${dir.package.sql}">
      <fileset dir="${dir.sql}"/>
    </copy>
  </target>
  
  <target name="doc" depends="lib">
    <mkdir dir="${dir.package.doc}"/>
    <javadoc destdir="${dir.package.doc}" classpath="${dir.package.lib}/openadaptor.jar:${dir.package.lib}/openadaptor-spring.jar" doctitle="openadaptor ${tag}" verbose="false">
      <fileset dir="${dir.src}"/>
      <fileset dir="${dir.spring.src}"/>
    </javadoc>
  </target>
  
</project>