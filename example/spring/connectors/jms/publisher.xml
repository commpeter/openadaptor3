<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">

<!--
    This adaptor does the following...
    
      * reads data from stdin
      * publishes data to a JMS queue
    
    It is designed to illustrate the basic structure of an adaptor that processes
    data by publishing onto rendezvous.

    Run it like this...
    
      java org.oa3.spring.SpringApplication -config publisher.xml -bean Adaptor
    
    You need the following in your classpath
  
      lib
      lib/openadaptor.jar
      lib/openadaptor-spring.jar
      lib/openadaptor-depends.jar
      jbossall-client.jar (this is not distributed with openadaptor)
    
    This example relies on a default instance of jboss running (http://www.jboss.org) on the
    same machine that the example is being run.
     
    Once it is running you need to type some data into the command line. To
    verify that this is working you need to be running the corresponding
    subscriber example.
-->

<beans>
  
  <bean id="Adaptor" class="org.oa3.core.adaptor.Adaptor">
    <property name="messageProcessor" ref="Router"/>
  </bean>
  
  <bean id="Router" class="org.oa3.core.router.Router">
    <property name="routingMap" ref="RoutingMap"/>
  </bean>
  
  <bean id="RoutingMap" class="org.oa3.core.router.RoutingMap">
    <property name="processMap">
      <map>
        <entry key-ref="Reader" value-ref="Writer"/>
      </map>
    </property>
  </bean>

  <bean id="Reader" class="org.oa3.auxil.connector.iostream.reader.StreamReadConnector">
    <property name="streamReader">
      <bean class="org.oa3.auxil.connector.iostream.reader.FileReader"/>
    </property>
    <property name="recordReader">
      <bean class="org.oa3.auxil.connector.iostream.reader.StringRecordReader"/>
    </property>
  </bean>

  <!-- This defines jndi connection, from which we get jms connection -->
  <bean id="JndiConnection" class="org.oa3.auxil.connector.jndi.JNDIConnection">
    <property name="initialContextFactory" value="org.jnp.interfaces.NamingContextFactory"/>
    <property name="providerUrl" value="jnp://localhost:1099"/>
  </bean>
  
  <!-- jms connection for queue we wish to publish to -->
  <bean id="JmsConnection" class="org.oa3.auxil.connector.jms.JMSConnection">
    <property name="jndiConnection" ref="JndiConnection"/>
    <property name="connectionFactoryName" value="ConnectionFactory"/>
    <property name="destinationName" value="queue/testQueue"/>
    <property name="queue" value="true"/>
    <property name="durable" value="true"/>
  </bean>
  
  <!-- writer that publishes data onto a queue -->
  <bean id="Writer" class="org.oa3.auxil.connector.jms.JMSWriteConnector">
    <property name="jmsConnection" ref="JmsConnection"/>
  </bean>

</beans>