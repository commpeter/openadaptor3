<!-- style sheet -->
<style type="text/css">
  p            { font-weight: bold; }
  th           { text-align: left; }
  .highlight   { background-color: FFFFCC; }  
  .retry       { background-color: EEEEEE; }  
  .original    { background-color: CCCCCC; }
  .idretry     { background-color: EEEEEE; text-align: center; }  
  .idoriginal  { background-color: CCCCCC; }  
</style>

<script language="JavaScript">
<!--
  function refresh() {
    window.location.reload(false);
  }
  function submitRefreshForm() {
    document.refreshForm.submit();
  }
//-->    
</script>
<html>
<title> Exception Manager</title>
#set ( $refreshRate = "1" )
#if ( $!SESSION.getAttribute("refreshRate") != "")
  #set ( $refreshRate = $SESSION.getAttribute("refreshRate") )
#end
  
<body onload="setTimeout('refresh()', $refreshRate * 60 * 1000)">
#if ($messages != "")
<textarea readonly="true" cols="80">$messages</textarea>
#end
#set ( $prevDate = "" )
#set ( $prevParentId = "" )
#set ( $retryIds = "" )
#set ( $todayIds = "" )
#set ( $pageIds = "" )
  
<form>  
<table>
  <thead>
  <tr>
    <td><input type="textbox" name='idFilter' size='6' value='$!SESSION.getAttribute("idFilter")'/></td>
    <td><input type="textbox" name='fromFilter' value='$!SESSION.getAttribute("fromFilter")'/></td>
    <td><input type="textbox" name='dateFilter' size='8' value='$!SESSION.getAttribute("dateFilter")'/></td>
    <td><input type="submit" value='Filter'/></td>
    <td/><td/><td/><td/>
  </tr>
    <tr><th>ID</th><th>FROM</th><th>DATE</th><th>TIME</th><th>MESSAGE</th><th/><th/><th/><tr/>
  </thead>
#foreach ( $summary in $summaries )
  #if ( $summary.ParentId == "" ) #set ( $prevParentId = $summary.Id ) #end
  #if ( $summary.ParentId == $prevParentId ) 
    #set ($rowClass = "retry") 
    #set ($idClass = "idretry")
    #set ( $retryIds = "$retryIds,$summary.Id") 
    #if ( $pageIds != "" )
      <td/></tr>
    #end
  #else 
    #set ($rowClass = "original") 
    #set ($idClass = "idoriginal")
    #if ($retryIds != "")
      <td><a href="?action=deleteall&ids=${retryIds}">Delete All</a></td></tr>
    #elseif ( $pageIds != "" )
      <td></tr>
    #end
    #set ( $retryIds = "" )
    #set ( $date = $DATE_FORMATTER.format($summary.Date) )
  #end
  #if ( $summary.Id == $id ) #set ( $rowClass = "highlight" ) #end

  #set ( $pageIds = "$pageIds,$summary.Id")
    
  #if ( $date != $prevDate)
    #if ( $todayIds != "")
      <tr><td/><td/><td/><td/><td/><td/><td/><td><a href="?action=deleteall&ids=${todayIds}">Delete All</a></td></tr>
    #end
    #set ( $todayIds = "" )
  #end
  #set ( $todayIds = "$todayIds,$summary.Id")  
  <tr class="${rowClass}">
    <td class="${idClass}"><a href="?action=browse&id=${summary.Id}">$summary.Id</a></td>
    <td>$summary.From</td>
    <td>$date</td>
    <td>$TIME_FORMATTER.format($summary.Date)</td>
    <td>$summary.Message</td>
    <td>
      #if ($summary.RetryAddress != "")
        <a href="?action=retry&id=${summary.Id}">Retry</a> [$summary.Retries]
      #end
    </td>
    <td><a href="?action=delete&id=${summary.Id}">Delete</a></td>
  #set ( $prevDate = $date )
#end
#if ($retryIds != "")
  <td><a href="?action=deleteall&ids=${retryIds}">Delete All</a></td></tr>
#elseif ( $pageIds != "" )
  <td/></tr>
#end
#if ( $todayIds != "" )
  <tr><td/><td/><td/><td/><td/><td/><td/><td><a href="?action=deleteall&ids=${todayIds}">Delete All</a></td></tr>
#end
</table>
</form>
        
<form name="refreshForm">
<table>
  <tr>
    <td>Most Recent ${summaries.size()} of $allIds.size() </td>
    <td>, show last <input type='text' maxlength='3' size='3' name='show' value='$!SESSION.getAttribute("show")'/> entries</td>
    <td>, automatically refreshes every <input type='text' maxlength='3' size='3' name='refreshRate' value='$refreshRate'/>  minute(s) </td>
    <td><a href="javascript:submitRefreshForm()">Refresh</a></td>
    <td><a href="?action=deleteall&ids=${pageIds}">Delete All</a></td>
  </tr>
</table> 
</form>

#set ($count = 0)
#set ($prevId = "")
#set ($lastId = "")
<table><tr>
#foreach ( $id in $allIds )
  #if ( $count % 50 == 0)
    #if ($prevId != "")
      <td><a href="?action=list&idFilter=${id}-${prevId}">${prevId}-${id}</a></td>
    #end
    #set ($prevId = $id)
  #end
  #set ($lastId = $id)
  #set ($count = $count + 1)
#end

#if ( $lastId != "")
<td><a href="?action=list&idFilter=${lastId}-${prevId}">${prevId}-${lastId}</a></td>
#end
</tr></table>
                
</body>
</html>

